<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù†Ø´Ø±</title>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
  <style>
    body {
      font-family: 'Arial', sans-serif;
      background-color: #f9f9f9;
      padding: 50px 20px;
      margin: 0;
      text-align: center;
    }

    h1 {
      margin-bottom: 30px;
      color: #333;
    }

    .blue-btn {
      background-color: #007BFF;
      color: white;
      border: none;
      padding: 16px 32px;
      margin: 8px;
      cursor: pointer;
      border-radius: 6px;
      font-size: 20px;
    }

    .green-btn {
      background-color: #28a745;
      color: white;
      border: none;
      padding: 16px 32px;
      margin: 8px;
      cursor: pointer;
      border-radius: 6px;
      font-size: 20px;
    }

    .blue-btn:hover {
      background-color: #0056b3;
    }

    .green-btn:hover {
      background-color: #1e7e34;
    }

    .button-container {
      display: flex;
      justify-content: center;
      gap: 10px;
      flex-wrap: wrap;
    }

    .button-container button {
      width: 150px;
      font-size: 16px;
    }

    .table-container {
      display: none;
      margin-top: 30px;
      overflow-x: auto;
    }

    table {
      border-collapse: collapse;
      width: 100%;
      max-width: 1200px;
      margin: 0 auto;
      background-color: #14a33a;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    }

    th, td {
      border: 1px solid #ddd;
      padding: 14px 18px;
      text-align: center;
      min-width: 120px;
    }

    th {
      background-color: #eeeeee;
      color: #333;
      font-weight: bold;
    }

    input[type="text"], input[type="date"] {
      width: 100%;
      padding: 10px;
      box-sizing: border-box;
      font-size: 16px;
      border-radius: 4px;
      border: 1px solid #ccc;
    }

    input[type="checkbox"] {
      transform: scale(1.2);
      cursor: pointer;
    }

    .action-buttons {
      margin-top: 20px;
    }

    .delete-button {
      background-color: #f44336;
      color: white;
      padding: 12px 24px;
      border: none;
      border-radius: 6px;
      font-size: 18px;
      cursor: pointer;
      margin: 8px;
    }

    .delete-button:hover {
      background-color: #d32f2f;
    }

    @media (max-width: 600px) {
      button {
        width: 100%;
        margin: 5px 0;
      }

      table {
        font-size: 14px;
      }
    }
  </style>
</head>
<body>

<h1>Ø§Ø®ØªØ± Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø°ÙŠ ØªØ±ÙŠØ¯Ù‡</h1>

<div class="button-container">
  <button class="blue-btn" onclick="showTable('mrb')">Ù…Ø±Ø¨Ø¹</button>
  <button class="green-btn" onclick="showTable('reels')">Ø±ÙŠÙ„Ø²</button>
</div>

<div id="table-container" class="table-container"></div>

<script>
  // âœ… Ø¨ÙŠØ§Ù†Ø§Øª Supabase
const supabaseUrl = 'https://uemmbigftrrsejzucgxo.supabase.co';
const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InVlbW1iaWdmdHJyc2VqenVjZ3hvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTg3OTE5NTksImV4cCI6MjA3NDM2Nzk1OX0.ku6ibVn84Pw1a-_2sWTRia3fynuxE7Axi3qXip6oI8k';
const supabase = supabase.createClient(supabaseUrl, supabaseKey);

async function showTable(type) {
  const tableContainer = document.getElementById('table-container');
  tableContainer.style.display = 'block';
  tableContainer.innerHTML = '';

  let headers = ['Ø§Ù„ÙŠÙˆÙ…', 'Ø§Ù„ØªØ§Ø±ÙŠØ®', 'Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…Ù‚Ø·Ø¹', 'Instagram'];

  if (type === 'mrb') {
    headers = ['Ø§Ù„ÙŠÙˆÙ…', 'Ø§Ù„ØªØ§Ø±ÙŠØ®', 'Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…Ù‚Ø·Ø¹', 'Facebook', 'Telegram', 'Instagram', 'X', 'WhatsApp'];
  } else if (type === 'reels') {
    headers = ['Ø§Ù„ÙŠÙˆÙ…', 'Ø§Ù„ØªØ§Ø±ÙŠØ®', 'Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…Ù‚Ø·Ø¹', 'Instagram', 'TikTok'];
  }

  const table = document.createElement('table');
  const thead = document.createElement('thead');
  const headRow = document.createElement('tr');

  headers.forEach(header => {
    const th = document.createElement('th');
    th.textContent = header;
    headRow.appendChild(th);
  });

  thead.appendChild(headRow);
  table.appendChild(thead);

  const tbody = document.createElement('tbody');
  for (let i = 0; i < 8; i++) {
    const row = document.createElement('tr');

    headers.forEach((header) => {
      const cell = document.createElement('td');
      let input;

      if (header === 'Ø§Ù„ÙŠÙˆÙ…' || header === 'Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…Ù‚Ø·Ø¹') {
        input = document.createElement('input');
        input.type = 'text';
      } else if (header === 'Ø§Ù„ØªØ§Ø±ÙŠØ®') {
        input = document.createElement('input');
        input.type = 'date';
      } else {
        input = document.createElement('input');
        input.type = 'checkbox';
      }

      cell.appendChild(input);
      row.appendChild(cell);
    });

    tbody.appendChild(row);
  }

  table.appendChild(tbody);
  tableContainer.appendChild(table);

  // Ø£Ø²Ø±Ø§Ø±
  const actionDiv = document.createElement('div');
  actionDiv.className = 'action-buttons';

  const saveBtn = document.createElement('button');
  saveBtn.textContent = 'Ø­ÙØ¸ Ø§Ù„Ø¬Ø¯ÙˆÙ„';
  saveBtn.className = 'blue-btn';
  saveBtn.onclick = () => saveTableData(type, table);

  const deleteBtn = document.createElement('button');
  deleteBtn.textContent = 'Ø­Ø°Ù Ø§Ù„Ø¬Ø¯ÙˆÙ„';
  deleteBtn.classList.add('delete-button');
  deleteBtn.onclick = () => deleteTableData(type, table);

  actionDiv.appendChild(saveBtn);
  actionDiv.appendChild(deleteBtn);

  tableContainer.appendChild(actionDiv);

  // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Supabase
  loadSavedData(type, table);
}

async function saveTableData(type, table) {
  try {
    // Ø§Ù„Ø®Ø·ÙˆØ© 1: Ø­Ø°Ù Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø© Ù„ØªØ¬Ù†Ø¨ Ø§Ù„ØªÙƒØ±Ø§Ø±
    const { error: deleteError } = await supabase
      .from('publishing_schedule')
      .delete()
      .eq('type', type);

    if (deleteError) {
      console.error('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø­Ø°Ù:', deleteError);
      alert('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø­Ø°Ù Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©.');
      return;
    }

    // Ø§Ù„Ø®Ø·ÙˆØ© 2: Ø¬Ù…Ø¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
    const rows = Array.from(table.querySelectorAll('tbody tr'));
    const data = [];

    rows.forEach((row, rowIndex) => {
      Array.from(row.cells).forEach((cell, colIndex) => {
        const input = cell.querySelector('input');
        if (!input) return;

        data.push({
          type,
          row_index: rowIndex,
          column_index: colIndex,
          value: input.type === 'checkbox' ? null : input.value || '',  // ØªØ­Ø³ÙŠÙ†: Ø§Ø³ØªØ®Ø¯Ù… '' Ø¨Ø¯Ù„Ø§Ù‹ Ù…Ù† null Ù„Ù„Ù‚ÙŠÙ… Ø§Ù„ÙØ§Ø±ØºØ©
          checked: input.type === 'checkbox' ? input.checked : null
        });
      });
    });

    // Ø§Ù„Ø®Ø·ÙˆØ© 3: Ø¥Ø¯Ø±Ø§Ø¬ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
    const { error: insertError } = await supabase.from('publishing_schedule').insert(data);

    if (insertError) {
      console.error('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø¥Ø¯Ø±Ø§Ø¬:', insertError);
      alert('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø­ÙØ¸: ' + insertError.message);
    } else {
      alert('ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø¨Ù†Ø¬Ø§Ø­!');
      // Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„ØªØ£ÙƒÙŠØ¯ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)
      loadSavedData(type, table);
    }
  } catch (err) {
    console.error('Ø®Ø·Ø£ Ø¹Ø§Ù…:', err);
    alert('Ø­Ø¯Ø« Ø®Ø·Ø£ ØºÙŠØ± Ù…ØªÙˆÙ‚Ø¹ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø­ÙØ¸.');
  }
}

async function loadSavedData(type, table) {
  try {
    const { data, error } = await supabase
      .from('publishing_schedule')
      .select('*')
      .eq('type', type)
      .order('row_index')  // ØªØ­Ø³ÙŠÙ†: ØªØ±ØªÙŠØ¨ Ø­Ø³Ø¨ row_index Ù„Ø¶Ù…Ø§Ù† Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµØ­ÙŠØ­
      .order('column_index');

    if (error) {
      console.error('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„:', error);
      return;
    }

    const rows = table.querySelectorAll('tbody tr');
    data.forEach(entry => {
      const row = rows[entry.row_index];
      if (!row) return;
      const cell = row.cells[entry.column_index];
      if (!cell) return;
      const input = cell.querySelector('input');
      if (!input) return;

      if (input.type === 'checkbox') {
        input.checked = entry.checked || false;  // ØªØ­Ø³ÙŠÙ†: Ù‚ÙŠÙ…Ø© Ø§ÙØªØ±Ø§Ø¶ÙŠØ© false
      } else {
        input.value = entry.value || '';  // ØªØ­Ø³ÙŠÙ†: Ù‚ÙŠÙ…Ø© Ø§ÙØªØ±Ø§Ø¶ÙŠØ© ÙØ§Ø±ØºØ©
      }
    });
  } catch (err) {
    console.error('Ø®Ø·Ø£ ÙÙŠ loadSavedData:', err);
  }
}

async function deleteTableData(type, table) {
  const confirmed = confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ø£Ù†Ùƒ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ø¨ÙŠØ§Ù†Ø§Øª Ù‡Ø°Ø§ Ø§Ù„Ø¬Ø¯ÙˆÙ„ØŸ');
  if (!confirmed) return;

  try {
    const { error } = await supabase
      .from('publishing_schedule')
      .delete()
      .eq('type', type);

    if (error) {
      console.error('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø­Ø°Ù:', error);
      alert('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø­Ø°Ù: ' + error.message);
      return;
    }

    // Ù…Ø³Ø­ Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„Ø§Øª ÙÙŠ Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…Ø­Ù„ÙŠ
    const inputs = table.querySelectorAll('input');
    inputs.forEach(input => {
      if (input.type === 'checkbox') {
        input.checked = false;
      } else {
        input.value = '';
      }
    });

    alert('ØªÙ… Ø­Ø°Ù Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­!');
  } catch (err) {
    console.error('Ø®Ø·Ø£ Ø¹Ø§Ù… ÙÙŠ Ø§Ù„Ø­Ø°Ù:', err);
    alert('Ø­Ø¯Ø« Ø®Ø·Ø£ ØºÙŠØ± Ù…ØªÙˆÙ‚Ø¹ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø­Ø°Ù.');
  }
}

  // Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø§ØªØµØ§Ù„ (Ø£Ø¶ÙÙ‡ Ù…Ø¤Ù‚ØªÙ‹Ø§)
async function testSupabase() {
  try {
    console.log('Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù€ Supabase...');
    
    // Ø§Ø®ØªØ¨Ø§Ø± SELECT Ø¨Ø³ÙŠØ·
    const { data: testData, error: testError } = await supabase
      .from('publishing_schedule')
      .select('count')
      .single();  // ÙŠØ¬Ù„Ø¨ Ø¹Ø¯Ø¯ Ø§Ù„Ø³Ø¬Ù„Ø§Øª

    if (testError) {
      console.error('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„:', testError);
      alert('Ù…Ø´ÙƒÙ„Ø© ÙÙŠ Supabase: ' + testError.message);
    } else {
      console.log('Ø§Ù„Ø§ØªØµØ§Ù„ Ù†Ø§Ø¬Ø­! Ø¹Ø¯Ø¯ Ø§Ù„Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠ:', testData?.count || 0);
      alert('Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù€ Supabase ÙŠØ¹Ù…Ù„! Ø¹Ø¯Ø¯ Ø§Ù„Ø³Ø¬Ù„Ø§Øª: ' + (testData?.count || 0));
    }
  } catch (err) {
    console.error('Ø®Ø·Ø£ Ø¹Ø§Ù… ÙÙŠ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±:', err);
    alert('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±: ' + err.message);
  }
}

// Ø´ØºÙ‘Ù„ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
document.addEventListener('DOMContentLoaded', testSupabase);

  // Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø§ØªØµØ§Ù„ (Ø£Ø¶ÙÙ‡ Ù…Ø¤Ù‚ØªÙ‹Ø§ ÙÙ‚Ø·)
async function testSupabaseConnection() {
  console.log('ğŸ” Ø¨Ø¯Ø¡ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù€ Supabase...');
  try {
    // Ø§Ø®ØªØ¨Ø§Ø± 1: Ù‡Ù„ Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ù…ÙˆØ¬ÙˆØ¯ØŸ
    const { data: countData, error: countError } = await supabase
      .from('publishing_schedule')
      .select('count', { count: 'exact', head: true });

    if (countError) {
      console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ Ø§Ù„Ø¬Ø¯ÙˆÙ„:', countError.message);
      alert('âŒ Ù…Ø´ÙƒÙ„Ø© ÙÙŠ Ø§Ù„Ø¬Ø¯ÙˆÙ„: ' + countError.message + '\n\nØ£Ù†Ø´Ø¦ Ø§Ù„Ø¬Ø¯ÙˆÙ„ ÙÙŠ Supabase Ø£ÙˆÙ„Ø§Ù‹ (Ø§Ù„Ø®Ø·ÙˆØ© 2).');
      return;
    }

    console.log('âœ… Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ù…ÙˆØ¬ÙˆØ¯! Ø¹Ø¯Ø¯ Ø§Ù„Ø³Ø¬Ù„Ø§Øª:', countData?.count || 0);

    // Ø§Ø®ØªØ¨Ø§Ø± 2: Ù…Ø­Ø§ÙˆÙ„Ø© Ø¥Ø¯Ø±Ø§Ø¬ Ø¨ÙŠØ§Ù†Ø§Øª ØªØ¬Ø±ÙŠØ¨ÙŠØ© Ø¨Ø³ÙŠØ·Ø©
    const { error: insertTestError } = await supabase
      .from('publishing_schedule')
      .insert([{ type: 'test', row_index: 0, column_index: 0, value: 'test' }]);

    if (insertTestError) {
      console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø¥Ø¯Ø±Ø§Ø¬ Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠ:', insertTestError.message);
      alert('âŒ Ù…Ø´ÙƒÙ„Ø© ÙÙŠ Ø§Ù„Ø­ÙØ¸: ' + insertTestError.message + '\n\nØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª (Ø§Ù„Ø®Ø·ÙˆØ© 3).');
    } else {
      console.log('âœ… Ø§Ù„Ø¥Ø¯Ø±Ø§Ø¬ ÙŠØ¹Ù…Ù„! (ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø³Ø¬Ù„ ØªØ¬Ø±ÙŠØ¨ÙŠ)');
      alert('âœ… Ø§Ù„Ø§ØªØµØ§Ù„ ÙˆØ§Ù„Ø­ÙØ¸ ÙŠØ¹Ù…Ù„Ø§Ù†! Ø¹Ø¯Ø¯ Ø§Ù„Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ø¢Ù†: ' + (countData?.count + 1 || 1) + '\n\nØ§Ø­Ø°Ù Ø§Ù„Ø³Ø¬Ù„ Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠ Ù…Ù† Supabase Ø¥Ø°Ø§ Ø£Ø±Ø¯Øª.');
      
      // Ø­Ø°Ù Ø§Ù„Ø³Ø¬Ù„ Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠ ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§
      await supabase.from('publishing_schedule').delete().eq('type', 'test');
    }
  } catch (err) {
    console.error('âŒ Ø®Ø·Ø£ Ø¹Ø§Ù… ÙÙŠ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±:', err);
    alert('âŒ Ø®Ø·Ø£ ØºÙŠØ± Ù…ØªÙˆÙ‚Ø¹ ÙÙŠ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±: ' + err.message + '\n\nØªØ­Ù‚Ù‚ Ù…Ù† Console Ù„Ù„ØªÙØ§ØµÙŠÙ„.');
  }
}

// Ø´ØºÙ‘Ù„ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
document.addEventListener('DOMContentLoaded', testSupabaseConnection);

</script>
</body>
</html>
